name: Convertir CSV a JSON

on:
  workflow_dispatch:  # Permite ejecución manual desde GitHub

jobs:
  convertir:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout del repositorio
      uses: actions/checkout@v3

    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Instalar dependencias
      run: |
        pip install pandas

    - name: Ejecutar script de conversión
      run: |
        python csv_to_json.py

    - name: Verificar tamaño de archivos JSON
      run: |
        MAX_BYTES=104857600
        for archivo in datos_json/*.json; do
          TAM=$(stat -c %s "$archivo")
          if [ "$TAM" -gt "$MAX_BYTES" ]; then
            echo "❌ El archivo $archivo excede los 100 MB permitidos por GitHub (actual: $((TAM / 1048576)) MB)."
            exit 1
          else
            echo "✅ Tamaño de $archivo: $((TAM / 1048576)) MB."
          fi
        done
            git push
          fi
